class Solution {
private:

    TreeNode *first,*middle,*last,*prev;
public:

    void helper(TreeNode *root){
        if (root==NULL){
            return;
        }
        helper(root->left);
        if ((prev!=NULL) && (prev->val>root->val)){

            // agar pehli baar hora hai
            if (first==NULL){
                first=prev;
                middle=root;
            }
            else{
                last=root;
            }
        }
        prev=root;
        helper(root->right);
    }

    void recoverTree(TreeNode* root) {
        first=NULL,middle=NULL,last=NULL;
        helper(root);
        if (first && last){
            swap(first->val,last->val);
        }
        else{
            swap(first->val,middle->val);
        }
    }
};
